<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open Credit</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div class="container">
    <h2>Select Debit Account and View Credits</h2>

    <!-- Выбор дебетового счета -->
    <div class="form-group">
        <label for="debitAccount">Choose Debit Account:</label>
        <select id="debitAccount" name="debitAccount">
            <option value="" disabled selected>Select Account</option>
            <option th:each="account : ${accounts}" th:value="${account.id}" th:text="${account.accountNumber}"></option>
        </select>
    </div>

    <!-- Место для динамического отображения кредитов -->
    <div id="creditList">
        <h3>Credits</h3>
        <ul id="credits">
            <li>Select a debit account to view its credits</li>
        </ul>
    </div>
</div>

<script>
    // Получаем select элемент для выбора счета
    const debitAccountSelect = document.getElementById('debitAccount');

    // Добавляем обработчик события изменения для выбора счета
    debitAccountSelect.addEventListener('change', function () {
        const accountId = debitAccountSelect.value;

        if (accountId) {
            // Используем fetch для выполнения AJAX-запроса
            fetch('/credit/get-credits/' + accountId)
                .then(response => response.json()) // Преобразуем ответ в JSON
                .then(data => {
                    const creditList = document.getElementById('credits');
                    creditList.innerHTML = ''; // Очищаем список перед добавлением новых данных

                    // Если кредиты найдены, добавляем их в список
                    if (data.length > 0) {
                        data.forEach(credit => {
                            const listItem = document.createElement('li');
                            listItem.textContent = `Amount: ${credit.amount}, Term: ${credit.term} months, Rate: ${credit.rate}%`;
                            creditList.appendChild(listItem);
                        });
                    } else {
                        // Если кредитов нет, выводим сообщение
                        const noCreditsMessage = document.createElement('li');
                        noCreditsMessage.textContent = 'No credits available for this account';
                        creditList.appendChild(noCreditsMessage);
                    }
                })
                .catch(error => {
                    console.error('Error fetching credits:', error);
                    alert('Failed to load credits');
                });
        }
    });
</script>
</body>
</html>
